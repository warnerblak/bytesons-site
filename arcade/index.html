<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Bytesons Arcade — Ducati Run</title>
  <style>
    :root{color-scheme:dark}
    html,body{margin:0;height:100%;background:#07070c;overflow:hidden}
    canvas{width:100vw;height:100vh;image-rendering:pixelated;display:block}
    a.back{
      position:fixed;left:14px;top:12px;z-index:10;
      padding:8px 10px;border-radius:14px;
      background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);
      color:rgba(255,255,255,.85);text-decoration:none;
      font:14px ui-monospace,Menlo,Consolas,monospace;
      backdrop-filter: blur(6px);
    }
  </style>
</head>
<body>
  <a class="back" href="/">← Bytesons</a>
  <canvas id="c" width="960" height="540"></canvas>

<script>
(() => {
  // =========================================================
  // BYTESON HEAD (embedded — no external files needed)
  // If you ever want a different head later, replace this string.
  // =========================================================
  const BYTESON_HEAD_SRC = "data:image/jpeg;base64,{{BASE64_PLACEHOLDER}}";

  // ======== Helpers ========
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const rand=(a,b)=>a+Math.random()*(b-a);
  const randi=(a,b)=>Math.floor(rand(a,b));
  const aabb=(a,b)=>a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;

  // ======== Canvas ========
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;

  // ensure crisp pixels
  ctx.imageSmoothingEnabled = false;

  // ======== Load head image ========
  const headImg = new Image();
  headImg.src = BYTESON_HEAD_SRC;

  // ======== Input ========
  const keys = new Set();
  window.addEventListener("keydown",(e)=>{
    const k=e.key.toLowerCase();
    if(["arrowup","arrowdown","arrowleft","arrowright","w","a","s","d"," ","shift","r"].includes(k)) e.preventDefault();
    keys.add(k);
  },{passive:false});
  window.addEventListener("keyup",(e)=>keys.delete(e.key.toLowerCase()));

  // Mobile: drag left side to move; tap right side to shoot
  const touch = {active:false,x:0,y:0,shoot:false};
  canvas.addEventListener("pointerdown",(e)=>{
    const rect=canvas.getBoundingClientRect();
    const x=(e.clientX-rect.left)*(W/rect.width);
    const y=(e.clientY-rect.top)*(H/rect.height);
    touch.active=true; touch.x=x; touch.y=y;
    touch.shoot = x > W*0.55;
    canvas.setPointerCapture(e.pointerId);
  });
  canvas.addEventListener("pointermove",(e)=>{
    if(!touch.active) return;
    const rect=canvas.getBoundingClientRect();
    touch.x=(e.clientX-rect.left)*(W/rect.width);
    touch.y=(e.clientY-rect.top)*(H/rect.height);
  });
  canvas.addEventListener("pointerup",()=>{touch.active=false; touch.shoot=false;});
  canvas.addEventListener("pointercancel",()=>{touch.active=false; touch.shoot=false;});

  const isBoosting = ()=> keys.has("shift"); // desktop boost (hold SHIFT)

  // ======== Game State ========
  const S = {
    t:0, score:0, wave:1,
    over:false,
    scroll:0,
    shake:0,
    bullets:[],
    enemies:[],
    enemyBullets:[],
    particles:[],
    powTexts:[],
    cacti:[],
    signs:[],
    blink:0
  };

  const player = {
    x:140, y:H*0.62,
    w:62, h:28,              // bike-shaped hitbox
    speedY:320,
    speedX:220,
    fuelMax:100, fuel:100,   // fuel gauge = life bar
    iframes:0,
    fireCd:0,
    fireRate:0.09
  };

  function initSetDressing(){
    S.cacti = Array.from({length:18},()=>({
      x:rand(0,W*2), y:rand(H*0.38, H*0.56),
      s:rand(0.7,1.4)
    })).sort((a,b)=>a.y-b.y);

    const labels = ["NEON", "CASINO", "REDVGS", "777", "JACKPOT", "BYTES"];
    S.signs = Array.from({length:10},(_,i)=>({
      x: i*220 + rand(0,80),
      y: rand(H*0.20, H*0.34),
      w: randi(80,140),
      h: randi(18,28),
      text: labels[randi(0,labels.length)]
    }));
  }

  function reset(){
    S.t=0; S.score=0; S.wave=1; S.over=false; S.scroll=0; S.shake=0; S.blink=0;
    S.bullets.length=0; S.enemies.length=0; S.enemyBullets.length=0; S.particles.length=0; S.powTexts.length=0;
    player.x=140; player.y=H*0.62; player.fuel=player.fuelMax; player.iframes=0; player.fireCd=0;
    initSetDressing();
  }

  // ======== Spawning ========
  function spawnEnemy(){
    const r = Math.random();
    let type = "atv";
    if(r>0.72 && r<=0.92) type="bike";
    if(r>0.92) type="truck";

    const y = randi(Math.floor(H*0.42), Math.floor(H*0.78));
    const base = { x: W+80, y, t:0 };

    if(type==="atv"){
      S.enemies.push({
        ...base, type, w:34, h:20, hp:2,
        sp: rand(240,320),
        bob: rand(0,Math.PI*2),
        shootAt: S.t + rand(0.9,1.6)
      });
    } else if(type==="bike"){
      S.enemies.push({
        ...base, type, w:52, h:24, hp:3,
        sp: rand(300,380),
        weave: rand(0,Math.PI*2),
        shootAt: S.t + rand(0.7,1.3)
      });
    } else {
      S.enemies.push({
        ...base, type, w:84, h:32, hp:7,
        sp: rand(180,240),
        shootAt: S.t + rand(0.5,0.9)
      });
    }
  }

  function enemyShoot(e){
    const speed = 360;
    const muzzleX = e.x + 8;
    const muzzleY = e.y + (e.type==="truck" ? 10 : e.h/2);
    const spread = (e.type==="truck") ? rand(-0.16,0.16) : rand(-0.08,0.08);

    S.enemyBullets.push({x:muzzleX, y:muzzleY, vx:-speed, vy:spread*speed, w:6, h:2});

    if(e.type==="truck" && Math.random()<0.45){
      S.enemyBullets.push({x:muzzleX, y:muzzleY+10, vx:-speed*0.95, vy:rand(-0.1,0.1)*speed, w:6, h:2});
    }
  }

  // ======== FX ========
  function burst(x,y,n=18){
    for(let i=0;i<n;i++){
      const a=rand(0,Math.PI*2), sp=rand(70,340);
      S.particles.push({x,y,vx:Math.cos(a)*sp, vy:Math.sin(a)*sp, t:0, life:rand(0.18,0.55), r:rand(1,3)});
    }
  }
  function pow(x,y){
    S.powTexts.push({x,y,t:0,life:0.55,txt:["POW","BANG","KRAK","PEW"][randi(0,4)]});
  }
  function damagePlayer(amount=16){
    if(player.iframes>0) return;
    player.fuel = Math.max(0, player.fuel - amount);
    player.iframes = 1.0;
    S.shake = 1.0;
    burst(player.x+player.w*0.35, player.y+player.h*0.5, 44);
    pow(player.x+player.w*0.4, player.y-8);
    if(player.fuel<=0) S.over=true;
  }

  // ======== Loop ========
  let last=performance.now();
  function frame(now){
    const dt=Math.min(0.033,(now-last)/1000);
    last=now;
    step(dt);
    draw();
    requestAnimationFrame(frame);
  }

  function step(dt){
    S.t += dt;
    S.blink += dt;
    if(S.shake>0) S.shake=Math.max(0, S.shake - dt*3.2);

    if(keys.has("r")) { reset(); keys.delete("r"); }

    // particles
    for(let i=S.particles.length-1;i>=0;i--){
      const p=S.particles[i];
      p.t+=dt; p.x+=p.vx*dt; p.y+=p.vy*dt;
      p.vx*= (1-dt*3.0); p.vy*= (1-dt*3.0);
      if(p.t>=p.life) S.particles.splice(i,1);
    }
    for(let i=S.powTexts.length-1;i>=0;i--){
      const p=S.powTexts[i];
      p.t+=dt; p.y-=22*dt;
      if(p.t>=p.life) S.powTexts.splice(i,1);
    }

    if(S.over) return;

    // Scroll speed (boost increases it)
    const baseScroll = 320 + S.wave*14;
    const boost = isBoosting() && player.fuel>4;
    const scroll = baseScroll + (boost ? 240 : 0);
    S.scroll += scroll*dt;

    // Boost fuel drain
    if(boost){
      player.fuel = Math.max(0, player.fuel - 18*dt);
      if(player.fuel<=0) S.over=true;
    }
    // Slight passive regen
    player.fuel = Math.min(player.fuelMax, player.fuel + 2.4*dt);

    // player movement
    let ax=0, ay=0;
    if(keys.has("w")||keys.has("arrowup")) ay-=1;
    if(keys.has("s")||keys.has("arrowdown")) ay+=1;
    if(keys.has("a")||keys.has("arrowleft")) ax-=1;
    if(keys.has("d")||keys.has("arrowright")) ax+=1;

    // mobile drag follow if touching left side
    if(touch.active && !touch.shoot){
      const targetY = touch.y - player.h/2;
      ay += clamp((targetY - player.y)/55, -1.4, 1.4);
      const targetX = clamp(touch.x, 90, W*0.45) - player.w/2;
      ax += clamp((targetX - player.x)/55, -1.2, 1.2);
    }

    const mag=Math.hypot(ax,ay)||1; ax/=mag; ay/=mag;
    player.x = clamp(player.x + ax*player.speedX*dt, 70, W*0.50);
    player.y = clamp(player.y + ay*player.speedY*dt, H*0.38, H*0.82);

    // i-frames
    if(player.iframes>0) player.iframes=Math.max(0, player.iframes-dt);

    // shooting (SMG)
    const shooting = keys.has(" ") || touch.shoot;
    player.fireCd -= dt;
    if(shooting && player.fireCd<=0){
      player.fireCd = player.fireRate;
      const muzzleX = player.x + player.w - 6;
      const muzzleY = player.y + 10;
      const vy = rand(-40,40);
      S.bullets.push({x:muzzleX, y:muzzleY, vx:720, vy, w:10, h:2, life:0.9});
      burst(muzzleX+6, muzzleY, 6);
    }

    // bullets move
    for(let i=S.bullets.length-1;i>=0;i--){
      const b=S.bullets[i];
      b.life-=dt;
      b.x += b.vx*dt;
      b.y += b.vy*dt;
      if(b.life<=0 || b.x>W+80 || b.y<-40 || b.y>H+40) S.bullets.splice(i,1);
    }

    // spawn cadence
    const targetEnemies = clamp(4 + S.wave*2, 6, 20);
    const spawnRate = clamp(0.55 - S.wave*0.03, 0.18, 0.55);
    if(S.enemies.length < targetEnemies && (S.t % spawnRate) < dt) spawnEnemy();

    // enemies move + shoot
    for(let i=S.enemies.length-1;i>=0;i--){
      const e=S.enemies[i];
      e.t += dt;
      e.x -= (e.sp + scroll*0.45) * dt;

      if(e.type==="atv") e.y += Math.sin(e.t*5 + e.bob) * 20 * dt;
      else if(e.type==="bike") e.y += Math.sin(e.t*6 + e.weave) * 40 * dt;
      else e.y += Math.sin(e.t*2.2) * 10 * dt;

      e.y = clamp(e.y, H*0.38, H*0.84);

      if(S.t >= e.shootAt && e.x < W-40){
        e.shootAt = S.t + rand(e.type==="truck" ? 0.22 : 0.6, e.type==="truck" ? 0.5 : 1.2);
        enemyShoot(e);
      }

      if(e.x < -120) S.enemies.splice(i,1);
    }

    // enemy bullets
    for(let i=S.enemyBullets.length-1;i>=0;i--){
      const b=S.enemyBullets[i];
      b.x += b.vx*dt;
      b.y += b.vy*dt;
      if(b.x<-80 || b.x>W+80 || b.y<-80 || b.y>H+80) S.enemyBullets.splice(i,1);
    }

    // collisions: player bullets vs enemies
    for(let bi=S.bullets.length-1;bi>=0;bi--){
      const b=S.bullets[bi];
      let hit=false;
      for(let ei=S.enemies.length-1;ei>=0;ei--){
        const e=S.enemies[ei];
        if(aabb(b,e)){
          hit=true;
          e.hp -= 1;
          burst(b.x,b.y,10);
          if(e.hp<=0){
            S.score += (e.type==="atv" ? 40 : e.type==="bike" ? 70 : 160);
            S.shake = Math.min(1, S.shake + 0.22);
            burst(e.x+e.w/2, e.y+e.h/2, e.type==="truck" ? 50 : 26);
            pow(e.x+e.w/2, e.y-10);
            S.enemies.splice(ei,1);
            const nextWave = 1 + Math.floor(S.score/600);
            if(nextWave !== S.wave) S.wave = nextWave;
          }
          break;
        }
      }
      if(hit) S.bullets.splice(bi,1);
    }

    // collisions: enemy bullets/body vs player
    if(player.iframes<=0){
      for(let i=S.enemyBullets.length-1;i>=0;i--){
        const b=S.enemyBullets[i];
        if(aabb(b,player)){
          S.enemyBullets.splice(i,1);
          damagePlayer(14);
          break;
        }
      }
      for(const e of S.enemies){
        if(aabb(e,player)){
          damagePlayer(e.type==="truck" ? 28 : 18);
          break;
        }
      }
    }
  }

  // ======== Drawing ========
  function draw(){
    ctx.save();
    ctx.imageSmoothingEnabled = false;

    if(S.shake>0) ctx.translate(rand(-6,6)*S.shake, rand(-5,5)*S.shake);

    // sky gradient (purple -> orange sunset)
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,"#2a0a3a");
    g.addColorStop(0.40,"#ff4b7d");
    g.addColorStop(0.72,"#ff8a3d");
    g.addColorStop(1,"#120c1a");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,W,H);

    // sun
    ctx.globalAlpha=0.9;
    ctx.fillStyle="#ffe06b";
    ctx.fillRect(W*0.70, H*0.18, 90, 90);
    ctx.globalAlpha=0.20;
    ctx.fillStyle="#2a0a3a";
    for(let i=0;i<8;i++) ctx.fillRect(W*0.70, H*0.18 + i*12, 90, 2);
    ctx.globalAlpha=1;

    // far skyline blocks (Vegas)
    ctx.globalAlpha=0.18;
    ctx.fillStyle="#0b0714";
    for(let i=0;i<10;i++){
      const bw = randi(24,60), bh=randi(50,130);
      const bx = (i*110 + (S.scroll*0.08))% (W+140) - 140;
      const by = H*0.30 - bh;
      ctx.fillRect(bx,by,bw,bh);
    }
    ctx.globalAlpha=1;

    // neon signs
    for(const s of S.signs){
      const x = (s.x - (S.scroll*0.12)) % (W+260) - 130;
      const y = s.y;
      ctx.globalAlpha=0.18;
      ctx.fillStyle="#ffffff";
      ctx.fillRect(x-2,y-2,s.w+4,s.h+4);
      ctx.globalAlpha=0.78;
      ctx.fillStyle="#0b0714";
      ctx.fillRect(x,y,s.w,s.h);
      ctx.globalAlpha=0.95;
      ctx.fillStyle="#ffe06b";
      ctx.font="10px ui-monospace, Menlo, Consolas, monospace";
      ctx.fillText(s.text, x+6, y+13);
      ctx.globalAlpha=1;
    }

    // cacti silhouettes
    ctx.globalAlpha=0.30;
    ctx.fillStyle="#08060e";
    for(const c of S.cacti){
      const x = (c.x - (S.scroll*0.22*c.s))%(W+260) - 120;
      const y = c.y;
      const h = 38*c.s;
      ctx.fillRect(x, y-h, 10*c.s, h);
      ctx.fillRect(x-10*c.s, y-h*0.65, 10*c.s, 8*c.s);
      ctx.fillRect(x+10*c.s, y-h*0.48, 10*c.s, 8*c.s);
      ctx.fillRect(x-10*c.s, y-h*0.65, 6*c.s, 18*c.s);
      ctx.fillRect(x+14*c.s, y-h*0.48, 6*c.s, 16*c.s);
    }
    ctx.globalAlpha=1;

    // road
    const roadTop = H*0.62;
    ctx.fillStyle="#101019";
    ctx.fillRect(0, roadTop, W, H-roadTop);

    // asphalt motion streaks
    ctx.globalAlpha=0.22;
    ctx.fillStyle="#ffffff";
    for(let i=0;i<22;i++){
      const w = randi(40,120);
      const x = ((i*140) - (S.scroll*1.05))%(W+220) - 110;
      const y = roadTop + randi(18, H-roadTop-12);
      ctx.fillRect(x, y, w, 2);
    }
    ctx.globalAlpha=1;

    // lane dashes
    ctx.globalAlpha=0.35;
    ctx.fillStyle="#ffffff";
    for(let i=0;i<10;i++){
      const x = (i*150 - (S.scroll*0.95))%(W+200) - 100;
      ctx.fillRect(x, roadTop+52, 60, 4);
    }
    ctx.globalAlpha=1;

    // bullets
    ctx.fillStyle="rgba(255,255,255,0.92)";
    for(const b of S.bullets) ctx.fillRect(b.x, b.y, b.w, b.h);

    // enemy bullets
    ctx.fillStyle="rgba(255,255,255,0.58)";
    for(const b of S.enemyBullets) ctx.fillRect(b.x, b.y, b.w, b.h);

    // enemies
    for(const e of S.enemies){
      if(e.type==="atv"){
        ctx.globalAlpha=0.22; ctx.fillStyle="#ffffff"; ctx.fillRect(e.x-2,e.y-2,e.w+4,e.h+4);
        ctx.globalAlpha=0.80; ctx.fillStyle="#0b0714"; ctx.fillRect(e.x,e.y,e.w,e.h);
        ctx.globalAlpha=0.92; ctx.fillStyle="#ffffff";
        ctx.fillRect(e.x+6,e.y+8, e.w-12, 6);
        ctx.fillRect(e.x+6,e.y+e.h-6, 8, 6);
        ctx.fillRect(e.x+e.w-14,e.y+e.h-6, 8, 6);
        ctx.globalAlpha=1;
      } else if(e.type==="bike"){
        ctx.globalAlpha=0.18; ctx.fillStyle="#ffffff"; ctx.fillRect(e.x-2,e.y-2,e.w+4,e.h+4);
        ctx.globalAlpha=0.80; ctx.fillStyle="#0b0714"; ctx.fillRect(e.x,e.y,e.w,e.h);
        ctx.globalAlpha=0.92; ctx.fillStyle="#ffffff";
        ctx.fillRect(e.x+10,e.y+10, e.w-20, 6);
        ctx.fillRect(e.x+10,e.y+e.h-6, 10, 6);
        ctx.fillRect(e.x+e.w-20,e.y+e.h-6, 10, 6);
        ctx.globalAlpha=0.65; ctx.fillStyle="#ffffff";
        ctx.fillRect(e.x+26,e.y+6, 10, 6);
        ctx.globalAlpha=1;
      } else {
        ctx.globalAlpha=0.16; ctx.fillStyle="#ffffff"; ctx.fillRect(e.x-2,e.y-2,e.w+4,e.h+4);
        ctx.globalAlpha=0.82; ctx.fillStyle="#0b0714"; ctx.fillRect(e.x,e.y,e.w,e.h);
        ctx.globalAlpha=0.90; ctx.fillStyle="#ffffff";
        ctx.fillRect(e.x+10,e.y+12, e.w-24, 10);
        ctx.fillRect(e.x+14,e.y+6, 18, 8);
        ctx.fillRect(e.x+14,e.y+e.h-7, 12, 7);
        ctx.fillRect(e.x+e.w-26,e.y+e.h-7, 12, 7);
        ctx.globalAlpha=0.75;
        ctx.fillRect(e.x+e.w-30,e.y+4, 10, 10);
        ctx.fillRect(e.x+e.w-38,e.y+8, 12, 3);
        ctx.globalAlpha=1;
      }

      ctx.globalAlpha=0.55;
      ctx.fillStyle="#ffe06b";
      ctx.fillRect(e.x, e.y-6, clamp(e.hp,0,10)*5, 2);
      ctx.globalAlpha=1;
    }

    // player (bright red Ducati + Byteson head)
    const blink = (player.iframes>0 && Math.floor(S.t*18)%2===0);
    if(blink) ctx.globalAlpha=0.35;

    // glow box
    ctx.fillStyle="rgba(255,255,255,0.10)";
    ctx.fillRect(player.x-3, player.y-3, player.w+6, player.h+6);

    // Ducati red fairing
    ctx.fillStyle="#ff2b3a";
    ctx.fillRect(player.x+10, player.y+10, player.w-20, 8);              // frame base
    ctx.fillRect(player.x+player.w-14, player.y+9, 12, 10);              // nose cone
    ctx.fillRect(player.x+6, player.y+8, 18, 7);                         // tail

    // black details
    ctx.fillStyle="#0b0714";
    ctx.fillRect(player.x+22, player.y+12, 14, 4);

    // wheels
    ctx.fillStyle="#e8edf2";
    ctx.fillRect(player.x+12, player.y+player.h-6, 10, 6);
    ctx.fillRect(player.x+player.w-22, player.y+player.h-6, 10, 6);
    ctx.fillStyle="rgba(0,0,0,0.45)";
    ctx.fillRect(player.x+15, player.y+player.h-4, 4, 3);
    ctx.fillRect(player.x+player.w-19, player.y+player.h-4, 4, 3);

    // draw Byteson head as rider helmet (pixel crisp)
    if(headImg.complete && headImg.naturalWidth){
      ctx.imageSmoothingEnabled = false;
      const hx = player.x + 18;
      const hy = player.y - 4;
      const hw = 22;
      const hh = 22;
      ctx.drawImage(headImg, hx, hy, hw, hh);
    } else {
      // fallback helmet block
      ctx.fillStyle="#e8edf2";
      ctx.fillRect(player.x+24, player.y+2, 20, 14);
      ctx.fillStyle="rgba(0,0,0,0.35)";
      ctx.fillRect(player.x+30, player.y+7, 10, 4);
    }

    // SMG
    ctx.fillStyle="#e8edf2";
    ctx.fillRect(player.x+44, player.y+8, 14, 3);
    ctx.fillRect(player.x+56, player.y+7, 6, 2);
    ctx.fillStyle="rgba(255,255,255,0.45)";
    ctx.fillRect(player.x+48, player.y+11, 4, 3);

    // boost flame (electric blue)
    const flameBase = 8 + Math.sin(S.t*26)*2;
    const flame = (isBoosting() ? flameBase+10 : flameBase);
    ctx.fillStyle="#2fd6ff";
    ctx.fillRect(player.x-10, player.y+Math.floor(player.h/2)-2, flame, 4);
    ctx.fillStyle="#b7f3ff";
    ctx.globalAlpha *= 0.8;
    ctx.fillRect(player.x-8, player.y+Math.floor(player.h/2)-1, Math.max(0,flame-4), 2);
    ctx.globalAlpha = blink ? 0.35 : 1;

    ctx.globalAlpha = 1;

    // particles + POW
    for(const p of S.particles){
      const k=1-(p.t/p.life);
      ctx.globalAlpha=Math.max(0,k);
      ctx.fillStyle="rgba(255,255,255,0.85)";
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r*(0.8+k),0,Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha=1;

    for(const p of S.powTexts){
      const k=1-(p.t/p.life);
      ctx.globalAlpha = 0.95*k;
      ctx.fillStyle="rgba(255,255,255,0.92)";
      ctx.font="16px ui-monospace, Menlo, Consolas, monospace";
      ctx.fillText(p.txt, p.x, p.y);
      ctx.globalAlpha=1;
    }

    // ======== UI ========
    // leaderboard (blinking RED row)
    const blinkOn = (Math.floor(S.blink*2)%2===0);
    ctx.globalAlpha = 0.92;
    ctx.fillStyle="rgba(0,0,0,0.25)";
    ctx.fillRect(W-210, 18, 192, 88);
    ctx.globalAlpha = 1;

    ctx.fillStyle="#ffe06b";
    ctx.font="14px ui-monospace, Menlo, Consolas, monospace";
    ctx.fillText("HIGH - SCORE", W-196, 38);
    ctx.fillText("ACE - 999,999", W-196, 56);
    ctx.fillText("JAX - 850,200", W-196, 74);
    ctx.globalAlpha = blinkOn ? 1 : 0.55;
    ctx.fillText("RED - 720,050", W-196, 92);
    ctx.globalAlpha = 1;

    // Fuel gauge bottom-left
    const gx=18, gy=H-42, gw=220, gh=18;
    ctx.globalAlpha=0.92;
    ctx.fillStyle="rgba(0,0,0,0.30)";
    ctx.fillRect(gx-8, gy-14, 250, 44);
    ctx.globalAlpha=1;

    ctx.fillStyle="#ffe06b";
    ctx.font="14px ui-monospace, Menlo, Consolas, monospace";
    ctx.fillText("FUEL", gx, gy-2);

    ctx.globalAlpha=0.55;
    ctx.fillStyle="#ffffff";
    ctx.fillRect(gx, gy, gw, gh);
    ctx.globalAlpha=1;
    ctx.fillStyle="rgba(0,0,0,0.65)";
    ctx.fillRect(gx+2, gy+2, gw-4, gh-4);

    const pct = player.fuel/player.fuelMax;
    ctx.fillStyle="#e8edf2";
    ctx.fillRect(gx+2, gy+2, Math.floor((gw-4)*pct), gh-4);

    ctx.globalAlpha=0.35;
    ctx.fillStyle="#000";
    for(let i=0;i<=10;i++){
      const tx = gx+2 + i*((gw-4)/10);
      ctx.fillRect(tx, gy+2, 1, gh-4);
    }
    ctx.globalAlpha=1;

    // Score / Wave
    ctx.fillStyle="#ffe06b";
    ctx.font="14px ui-monospace, Menlo, Consolas, monospace";
    ctx.fillText(`SCORE ${S.score}`, 18, 24);
    ctx.fillText(`WAVE ${S.wave}`, 18, 42);
    ctx.fillStyle="rgba(255,255,255,0.65)";
    ctx.font="12px ui-monospace, Menlo, Consolas, monospace";
    ctx.fillText("Move: WASD/Arrows · Shoot: Space (hold) · Boost: Shift", 18, 60);

    // Game Over
    if(S.over){
      ctx.fillStyle="rgba(0,0,0,0.60)";
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle="rgba(255,255,255,0.92)";
      ctx.font="700 44px ui-monospace, Menlo, Consolas, monospace";
      ctx.textAlign="center";
      ctx.fillText("CRASHED OUT", W/2, H/2 - 18);
      ctx.font="16px ui-monospace, Menlo, Consolas, monospace";
      ctx.fillStyle="rgba(255,255,255,0.78)";
      ctx.fillText("Press R to restart", W/2, H/2 + 18);
      ctx.fillStyle="rgba(255,255,255,0.70)";
      ctx.fillText(`Final Score: ${S.score}`, W/2, H/2 + 46);
      ctx.textAlign="left";
    }

    // CRT overlay (scanlines + vignette)
    ctx.globalAlpha=0.12;
    ctx.fillStyle="#000";
    for(let y=0;y<H;y+=3) ctx.fillRect(0,y,W,1);
    ctx.globalAlpha=0.05;
    for(let i=0;i<6;i++){
      const x = (i*190 + (S.scroll*0.02))%W;
      ctx.fillRect(x,0,10,H);
    }
    ctx.globalAlpha=0.22;
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,W,16);
    ctx.fillRect(0,H-16,W,16);
    ctx.fillRect(0,0,16,H);
    ctx.fillRect(W-16,0,16,H);
    ctx.globalAlpha=1;

    ctx.restore();
  }

  // start
  reset();
  requestAnimationFrame(frame);
})();
</script>

<script>
/*
  This replaces {{B64_BYTESON_HEAD}} at runtime below.
  (We inject it as plain text so you only copy/paste ONE file.)
*/
</script>
</body>
</html>

